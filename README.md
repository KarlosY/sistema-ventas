# Sistema de Ventas

Este es un proyecto de un sistema de ventas simple construido con Next.js, TypeScript y Supabase. La aplicación sigue principios de arquitectura limpia para separar las preocupaciones del dominio, la aplicación y la infraestructura.

## Tecnologías Utilizadas

- **Framework:** [Next.js](https://nextjs.org) 14+
- **Lenguaje:** [TypeScript](https://www.typescriptlang.org)
- **Backend y Base de Datos:** [Supabase](https://supabase.io)
- **Estilos:** [Tailwind CSS](https://tailwindcss.com)
- **Arquitectura:** Limpia (Dominio, Aplicación, Infraestructura)

## Instalación y Configuración

Sigue estos pasos para levantar el proyecto en un entorno de desarrollo local.

### 1. Clonar el Repositorio

```bash
git clone https://github.com/KarlosY/sistema-ventas.git
cd sistema-ventas
```

### 2. Instalar Dependencias

```bash
npm install
```

### 3. Configurar la Base de Datos en Supabase

1.  Crea un nuevo proyecto en [Supabase](https://supabase.io).
2.  Ve a la sección **SQL Editor** > **New query**.
3.  Copia y pega el siguiente script completo y ejecútalo para crear todas las tablas necesarias en el orden correcto.

    **Script de Base de Datos Completo:**
    ```sql
    -- 1. Tabla de Categorías
    -- Almacena las diferentes categorías para los productos.
    CREATE TABLE public.categories (
      id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      name TEXT NOT NULL UNIQUE,
      created_at TIMESTAMPTZ NOT NULL DEFAULT now()
    );

    -- 2. Tabla de Productos
    -- Almacena los productos del inventario. Se relaciona con las categorías.
    CREATE TABLE public.products (
      id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      name TEXT NOT NULL,
      price NUMERIC NOT NULL CHECK (price >= 0),
      stock INT NOT NULL CHECK (stock >= 0),
      category_id BIGINT REFERENCES public.categories(id) ON DELETE SET NULL,
      created_at TIMESTAMPTZ NOT NULL DEFAULT now()
    );

    -- 3. Tabla de Ventas
    -- Registra cada transacción de venta.
    CREATE TABLE public.sales (
      id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      total_amount NUMERIC NOT NULL CHECK (total_amount >= 0),
      created_at TIMESTAMPTZ NOT NULL DEFAULT now()
    );

    -- 4. Tabla de Detalles de Venta
    -- Es una tabla intermedia que conecta productos y ventas.
    -- Almacena qué productos se vendieron en cada transacción, la cantidad y el precio en ese momento.
    CREATE TABLE public.sale_details (
      id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      sale_id BIGINT NOT NULL REFERENCES public.sales(id) ON DELETE CASCADE,
      product_id BIGINT REFERENCES public.products(id) ON DELETE SET NULL,
      quantity INT NOT NULL CHECK (quantity > 0),
      price NUMERIC NOT NULL CHECK (price >= 0),
      created_at TIMESTAMPTZ NOT NULL DEFAULT now()
    );

    -- 5. Creación de tipo para Roles de Usuario
    -- Un ENUM asegura que los roles solo puedan tener valores predefinidos.
    CREATE TYPE public.user_role AS ENUM ('Administrador', 'Vendedor');

    -- 6. Tabla de Perfiles de Usuario
    -- Almacena datos adicionales de los usuarios, como su rol.
    -- Se vincula a la tabla 'auth.users' de Supabase.
    CREATE TABLE public.profiles (
      id UUID NOT NULL PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
      role public.user_role NOT NULL DEFAULT 'Vendedor'::public.user_role
    );

    -- 7. Función para crear un perfil automáticamente
    -- Esta función se dispara cada vez que un nuevo usuario se registra en Supabase (auth.users).
    -- Inserta una nueva fila en nuestra tabla 'profiles' para ese usuario.
    CREATE OR REPLACE FUNCTION public.handle_new_user()
    RETURNS TRIGGER AS $$
    BEGIN
      INSERT INTO public.profiles (id, role)
      VALUES (new.id, 'Vendedor'); -- Por defecto, los nuevos usuarios son 'Vendedor'
      RETURN new;
    END;
    $$ LANGUAGE plpgsql SECURITY DEFINER;

    -- 8. Trigger para la función handle_new_user
    -- Vincula la función al evento de inserción en la tabla auth.users.
    CREATE TRIGGER on_auth_user_created
      AFTER INSERT ON auth.users
      FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();
    ```



### 4. Configurar las Variables de Entorno

1.  Crea un archivo `.env.local` en la raíz del proyecto.
2.  Añade las credenciales de tu proyecto de Supabase. Las encontrarás en **Project Settings > API**.

    ```env
    NEXT_PUBLIC_SUPABASE_URL=URL_DE_TU_PROYECTO
    NEXT_PUBLIC_SUPABASE_ANON_KEY=TU_ANON_KEY
    ```

### 5. Ejecutar la Aplicación

```bash
npm run dev
```

Abre [http://localhost:3000](http://localhost:3000) en tu navegador para ver la aplicación en funcionamiento.

## Funcionalidades Implementadas

- **Gestión de Productos y Categorías:**
  - Crear, leer, actualizar y eliminar productos.
  - Gestión completa de categorías: crear, asignar a productos y visualizar.
  - Creación dinámica de categorías desde el mismo formulario de producto.
  - Formulario unificado para creación y edición de productos.
- **Registro de Ventas:**
  - Añadir productos a un carrito de compras.
  - Filtrar productos por categoría en la página de ventas para agilizar la búsqueda.
  - Registrar la venta, lo que descuenta el stock de los productos correspondientes.
  - Validación de stock en tiempo real para no vender más de lo disponible.
- **Reportes Avanzados:**
  - Visualizar un historial detallado de todas las ventas realizadas.
  - Resumen de ventas con totales para el día y el mes en curso.
- **Mejoras de UI/UX y Localización:**
  - Notificaciones dinámicas y no intrusivas (toasts) para acciones del usuario.
  - Indicadores de carga (spinners) para operaciones asíncronas.
  - Estados vacíos mejorados en todas las páginas principales.
  - Navegación fluida con botones para volver al inicio.
  - Localización de moneda a Soles Peruanos (S/) en toda la aplicación.

## Licencia

Este proyecto está bajo la Licencia MIT. Consulta el archivo `LICENSE` para más detalles.

---

© 2025 Karlos Berrios - Ykar.NET
